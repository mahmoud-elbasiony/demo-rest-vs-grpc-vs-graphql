syntax = "proto3";

option java_multiple_files = true;
option java_package = "com.asset.demo.grpc";
option java_outer_classname = "BookProto";

package book;

// Author Service
service AuthorService {
    rpc GetAllAuthors(EmptyRequest) returns (AuthorListResponse);
    rpc GetAuthor(AuthorIdRequest) returns (AuthorMessage);
    rpc CreateAuthor(CreateAuthorRequest) returns (AuthorMessage);
    rpc UpdateAuthor(UpdateAuthorRequest) returns (AuthorMessage);
    rpc DeleteAuthor(AuthorIdRequest) returns (DeleteResponse);
    rpc GetAuthorBooks(AuthorIdRequest) returns (BookListResponse);
}

// Book Service
service BookService {
    rpc GetAllBooks(EmptyRequest) returns (BookListResponse);
    rpc GetBook(BookIdRequest) returns (BookMessage);
    rpc CreateBook(CreateBookRequest) returns (BookMessage);
    rpc UpdateBook(UpdateBookRequest) returns (BookMessage);
    rpc DeleteBook(BookIdRequest) returns (DeleteResponse);
    rpc SearchByAuthor(AuthorSearchRequest) returns (BookListResponse);

    // Server streaming – returns stream of BookMessage
    rpc StreamBooksByAuthor(AuthorIdRequest) returns (stream BookMessage) {}

    // Client Streaming – Example: bulk create books
    rpc BulkCreateBooks(stream CreateBookRequest) returns (BookListResponse) {}

    // Bidirectional streaming for bulk book creation
    // Client sends many CreateBookRequest
    // Server responds with many BookCreationResult (one per book + final summary)
    rpc BulkCreateBooksStream(stream CreateBookRequest) returns (stream BookCreationResult) {}
}

message EmptyRequest {}

// Author Messages
message AuthorIdRequest {
    int64 id = 1;
}

message CreateAuthorRequest {
    string name = 1;
    string email = 2;
    string bio = 3;
}

message UpdateAuthorRequest {
    int64 id = 1;
    string name = 2;
    string email = 3;
    string bio = 4;
}

message AuthorMessage {
    int64 id = 1;
    string name = 2;
    string email = 3;
    string bio = 4;
}

message AuthorListResponse {
    repeated AuthorMessage authors = 1;
}

// Book Messages
message BookIdRequest {
    int64 id = 1;
}

message CreateBookRequest {
    string title = 1;
    string isbn = 2;
    double price = 3;
    int64 authorId = 4;
}

message UpdateBookRequest {
    int64 id = 1;
    string title = 2;
    string isbn = 3;
    double price = 4;
    int64 authorId = 5;
}

message BookMessage {
    int64 id = 1;
    string title = 2;
    string isbn = 3;
    double price = 4;
    AuthorMessage author = 5;
}

message BookListResponse {
    repeated BookMessage books = 1;
}

message AuthorSearchRequest {
    string authorName = 1;
}

message DeleteResponse {
    bool success = 1;
}

message BookCreationResult {
  oneof result {
    BookMessage createdBook = 1;      // success case
    string errorMessage = 2;          // failure case
  }
  bool success = 3;
}
